<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">

<!-- =============================== -->
<!-- PAGE CONTENT -->
<!-- =============================== -->
<div layout:fragment="content">

    <style>
        .kpi-card {
            padding: 22px;
            border-radius: 14px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            transition: .25s ease;
        }

        .kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .chart-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
    </style>

    <h2 class="fw-semibold mb-4">Recruitment Analytics</h2>

    <!-- KPI CARDS -->
    <div class="row mb-4">

        <div class="col-md-3">
            <div class="kpi-card">
                <div class="text-muted small">Avg. Time to Shortlist</div>
                <h3 th:text="${data.avgTimeToShortlist + ' days'}"></h3>
            </div>
        </div>

        <div class="col-md-3">
            <div class="kpi-card">
                <div class="text-muted small">Avg. Time to Interview</div>
                <h3 th:text="${data.avgTimeToInterview + ' days'}"></h3>
            </div>
        </div>

        <div class="col-md-3">
            <div class="kpi-card">
                <div class="text-muted small">Interview â†’ Hire Time</div>
                <h3 th:text="${data.avgTimeInterviewToHire + ' days'}"></h3>
            </div>
        </div>

        <div class="col-md-3">
            <div class="kpi-card">
                <div class="text-muted small">Avg. Time to Hire</div>
                <h3 th:text="${data.avgTimeToHire + ' days'}"></h3>
            </div>
        </div>

    </div>

    <!-- CHART ROW -->
    <div class="row mb-4">

        <!-- Funnel -->
        <div class="col-md-6">
            <div class="chart-card">
                <h5 class="fw-semibold mb-3">Recruitment Funnel</h5>
                <canvas id="chartFunnel"></canvas>
            </div>
        </div>

        <!-- Monthly -->
        <div class="col-md-6">
            <div class="chart-card">
                <h5 class="fw-semibold mb-3">Monthly Applications</h5>
                <canvas id="chartMonthly"></canvas>
            </div>
        </div>

    </div>

    <!-- Applications per Job -->
    <div class="row">
        <div class="col-md-12">
            <div class="chart-card">
                <h5 class="fw-semibold mb-3">Applications per Job</h5>
                <canvas id="chartJobs"></canvas>
            </div>
        </div>
    </div>

    <!-- TOP CANDIDATES TABLE -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="chart-card">

                <h5 class="fw-semibold mb-3">
                    <i data-feather="star" class="me-2"></i>
                    Top Candidates
                </h5>

                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>Score</th>
                        <th>Job</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="c : ${data.topCandidates}">
                        <td th:text="${c.name}"></td>
                        <td th:text="${c.score}"></td>
                        <td th:text="${c.job}"></td>
                    </tr>
                    </tbody>
                </table>

            </div>
        </div>
    </div>

</div>


<!-- =============================== -->
<!-- JS (Injected into layout main.html) -->
<!-- =============================== -->
<div layout:fragment="scripts">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        feather.replace();

        const analytics = /*[[${data}]]*/ {};

        /* Recruitment Funnel */
        new Chart(document.getElementById('chartFunnel'), {
            type: 'bar',
            data: {
                labels: Object.keys(analytics.funnel),
                datasets: [{
                    label: "Candidates",
                    data: Object.values(analytics.funnel)
                }]
            }
        });

        /* Monthly Applications */
        new Chart(document.getElementById('chartMonthly'), {
            type: 'line',
            data: {
                labels: Object.keys(analytics.monthlyApplications),
                datasets: [{
                    label: "Applications",
                    data: Object.values(analytics.monthlyApplications),
                    fill: true,
                    tension: 0.4
                }]
            }
        });

        /* Job Application Counts */
        new Chart(document.getElementById('chartJobs'), {
            type: 'bar',
            data: {
                labels: Object.keys(analytics.jobApplicationCounts),
                datasets: [{
                    label: "Applications",
                    data: Object.values(analytics.jobApplicationCounts)
                }]
            }
        });
    </script>

</div>

</html>
