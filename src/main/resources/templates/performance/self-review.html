<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">

<head>
    <title>Self Review</title>

    <style>
        .rating-star {
            font-size: 32px;
            cursor: pointer;
            user-select: none;
            color: #ccc;
            transition: 0.2s ease;
            padding: 3px;
        }
        .rating-star.selected {
            color: #f1c40f;
            transform: scale(1.15);
        }
    </style>
</head>

<body>

<main layout:fragment="content">

    <h3 class="fw-semibold mb-3">
        <i data-feather="edit-3" class="me-2"></i>
        Self Review — <span th:text="${review.cycle}"></span>
    </h3>

    <form th:action="@{'/web/performance/self/' + ${review.id}}" method="post" class="mt-4">

        <!-- Rating -->
        <label class="form-label">Your Rating (1–5)</label>

        <div id="ratingStars" class="mb-3" data-feather-ignore="true">

        <span class="rating-star" data-value="1">★</span>
            <span class="rating-star" data-value="2">★</span>
            <span class="rating-star" data-value="3">★</span>
            <span class="rating-star" data-value="4">★</span>
            <span class="rating-star" data-value="5">★</span>
        </div>

        <input type="hidden" id="ratingInput" name="rating" required>

        <!-- Comments -->
        <label class="form-label mt-3">Comments</label>
        <textarea name="comments" class="form-control" rows="5" required></textarea>

        <button class="btn btn-primary mt-3 w-100">
            <i data-feather="check-circle" class="me-1"></i>
            Submit Review
        </button>

    </form>

</main>

</body>
<script>
    document.addEventListener("DOMContentLoaded", function () {

        // star rating JS
        const stars = document.querySelectorAll(".rating-star");
        const ratingInput = document.getElementById("ratingInput");

        stars.forEach(star => {
            star.addEventListener("click", () => {

                ratingInput.value = star.dataset.value;

                stars.forEach(s => s.classList.remove("selected"));
                star.classList.add("selected");

            });
        });

        // run feather AFTER stars exist
        feather.replace();
    });
</script>

</html>
