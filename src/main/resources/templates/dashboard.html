<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout/main}">

<main layout:fragment="content" class="dashboard px-4">

    <h2 class="fw-semibold mb-4">Dashboard</h2>

    <!-- KPI CARDS -->
    <div class="row g-4 mb-4">

        <div class="col-md-3">
            <div class="card kpi-card p-4">
                <div class="d-flex justify-content-between">
                    <div>
                        <p class="text-muted small mb-1">Total Employees</p>
                        <h3 th:text="${stats.totalEmployees}">0</h3>
                    </div>
                    <div class="card-icon"><i data-feather="users"></i></div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card kpi-card p-4">
                <div class="d-flex justify-content-between">
                    <div>
                        <p class="text-muted small mb-1">Active Onboarding</p>
                        <h3 th:text="${stats.onboardingActive}">0</h3>
                    </div>
                    <div class="card-icon"><i data-feather="layers"></i></div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card kpi-card p-4">
                <div class="d-flex justify-content-between">
                    <div>
                        <p class="text-muted small mb-1">Pending Leaves</p>
                        <h3 th:text="${stats.pendingLeaves}">0</h3>
                    </div>
                    <div class="card-icon"><i data-feather="calendar"></i></div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card kpi-card p-4">
                <div class="d-flex justify-content-between">
                    <div>
                        <p class="text-muted small mb-1">Open Positions</p>
                        <h3 th:text="${stats.openJobs}">0</h3>
                    </div>
                    <div class="card-icon"><i data-feather="briefcase"></i></div>
                </div>
            </div>
        </div>

    </div>

    <!-- CHARTS -->
    <div class="row g-4 mb-4">

        <div class="col-md-8">
            <div class="card p-4">
                <h5 class="mb-3">Employee Growth</h5>
                <canvas id="employeeGrowthChart"></canvas>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card p-4">
                <h5 class="mb-3">Leave Breakdown</h5>
                <canvas id="leavePieChart"></canvas>
            </div>
        </div>

    </div>

    <!-- RECRUITMENT + ONBOARDING -->
    <div class="row g-4">

        <div class="col-md-7">
            <div class="card p-4">
                <h5 class="mb-3">Recruitment Pipeline</h5>

                <div class="pipeline d-flex justify-content-between text-center">
                    <div>
                        <small class="text-muted">Applied</small>
                        <h4 th:text="${stats.appliedCount}">0</h4>
                    </div>
                    <div>
                        <small class="text-muted">Screening</small>
                        <h4 th:text="${stats.screeningCount}">0</h4>
                    </div>
                    <div>
                        <small class="text-muted">Interview</small>
                        <h4 th:text="${stats.interviewCount}">0</h4>
                    </div>
                    <div>
                        <small class="text-muted">Offers</small>
                        <h4 th:text="${stats.offerCount}">0</h4>
                    </div>
                </div>

            </div>
        </div>

        <div class="col-md-5">
            <div class="card p-4">
                <h5 class="mb-3">Onboarding Summary</h5>

                <div th:each="o : ${onboardingList}" class="mb-3 pb-3 border-bottom">

                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong th:text="${o.employeeName}">Employee</strong>
                            <small class="text-muted d-block"
                                   th:text="${o.employeeEmail}">email</small>
                        </div>
                        <div style="width:70px;height:70px;">
                            <canvas th:id="'donut-' + ${o.id}"></canvas>
                        </div>
                    </div>

                </div>

                <div th:if="${onboardingList == null or onboardingList.isEmpty()}"
                     class="text-muted text-center py-3">
                    No active onboardings
                </div>

            </div>
        </div>

    </div>

</main>

<!-- PAGE SCRIPTS -->
<div layout:fragment="scripts">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script th:inline="javascript">
        new Chart(document.getElementById("employeeGrowthChart"), {
            type: "line",
            data: {
                labels: /*[[${stats.months}]]*/ [],
                datasets: [{
                    data: /*[[${stats.employeeCounts}]]*/ [],
                    borderColor: "#4f46e5",
                    borderWidth: 3,
                    tension: 0.3,
                    pointRadius: 0
                }]
            },
            options: { plugins: { legend: { display: false } } }
        });

        new Chart(document.getElementById("leavePieChart"), {
            type: "pie",
            data: {
                labels: ["Approved", "Pending", "Rejected"],
                datasets: [{
                    data: [
                        /*[[${stats.leavesApproved}]]*/,
                        /*[[${stats.leavesPending}]]*/,
                        /*[[${stats.leavesRejected}]]*/
                    ],
                    backgroundColor: ["#10b981", "#f59e0b", "#ef4444"]
                }]
            }
        });
    </script>

</div>

</html>
