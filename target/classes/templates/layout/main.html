<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head layout:fragment="head">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Page Title -->
    <title layout:title-pattern="$DECORATOR - $CONTENT"
           th:text="${pageTitle} ?: 'EMS Dashboard'">EMS Dashboard</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Icons -->
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body class="light-mode">

<!-- ============================================================= -->
<!-- SIDEBAR -->
<!-- ============================================================= -->
<aside class="sidebar shadow-sm">
    <div class="sidebar-header text-center py-4">
        <h3 class="logo mb-0 fw-bold">EMS</h3>
        <small class="text-muted fs-6">HR Suite</small>
    </div>

    <ul class="nav flex-column mt-3">

        <!-- DASHBOARD -->
        <li class="nav-item">
            <a th:href="@{/web/dashboard}" class="nav-link">
                <i data-feather="grid"></i>
                <span>Dashboard</span>
            </a>
        </li>

        <!-- EMPLOYEES -->
        <li class="nav-item"
            th:if="${#authorization.expression('hasAnyRole(''ADMIN'', ''HR'')')}">
            <a th:href="@{/web/employees}" class="nav-link">
                <i data-feather="users"></i>
                <span>Employees</span>
            </a>
        </li>

        <!-- DEPARTMENTS -->
        <li class="nav-item"
            th:if="${#authorization.expression('hasAnyRole(''ADMIN'', ''HR'')')}">
            <a th:href="@{/web/departments}" class="nav-link">
                <i data-feather="briefcase"></i>
                <span>Departments</span>
            </a>
        </li>

        <!-- ATTENDANCE -->
        <li class="nav-item">
            <a class="nav-link"
               th:href="${#authorization.expression('hasRole(''EMPLOYEE'')')
                        ? '/web/attendance/my'
                        : '/web/attendance'}">
                <i data-feather="clock"></i>
                <span>Attendance</span>
            </a>
        </li>

        <!-- LEAVES -->
        <li class="nav-item">
            <a class="nav-link"
               th:href="${#authorization.expression('hasRole(''EMPLOYEE'')')
                        ? '/web/leave/my'
                        : '/web/leave'}">
                <i data-feather="calendar"></i>
                <span>Leaves</span>
            </a>
        </li>

        <!-- PAYROLL -->
        <li class="nav-item">
            <a class="nav-link"
               th:href="${#authorization.expression('hasRole(''EMPLOYEE'')')
                        ? '/web/payroll/my'
                        : '/web/payroll'}">
                <i data-feather="credit-card"></i>
                <span>Payroll</span>
            </a>
        </li>

        <!-- PERFORMANCE -->
        <li class="nav-item">
            <a class="nav-link"
               th:href="${#authorization.expression('hasRole(''EMPLOYEE'')')
                        ? '/web/performance/my'
                        : '/web/performance'}">
                <i data-feather="bar-chart-2"></i>
                <span>Performance</span>
            </a>
        </li>

        <!-- RECRUITMENT -->
        <li class="nav-item"
            th:if="${#authorization.expression('hasAnyRole(''ADMIN'',''HR'')')}">
        <a th:href="@{/web/recruitment/jobs}" class="nav-link">
                <i data-feather="search"></i>
                <span>Recruitment</span>
            </a>
        </li>



        <!-- ONBOARDING -->
        <li class="nav-item"
            th:if="${#authorization.expression('hasAnyRole(''ADMIN'',''HR'')')}">
            <a th:href="@{/web/onboarding}" class="nav-link">
                <i data-feather="layers"></i>
                <span>Onboarding</span>
            </a>
        </li>

        <!-- MY ONBOARDING (Employee Only) -->
        <li class="nav-item"
            th:if="${#authorization.expression('hasRole(''EMPLOYEE'')')}">
            <a th:href="@{/web/onboarding/my}" class="nav-link">
                <i data-feather="user-check"></i>
                <span>My Onboarding</span>
            </a>
        </li>

        <!-- LOGOUT -->
        <li class="nav-item mt-3">
            <form th:action="@{/logout}" method="post" class="w-100">
                <button class="nav-link text-danger w-100 d-flex align-items-center border-0 bg-transparent" style="cursor:pointer;">
                    <i data-feather="log-out"></i>
                    <span class="ms-2">Logout</span>
                </button>
            </form>
        </li>

    </ul>
</aside>

<!-- ============================================================= -->
<!-- MAIN CONTENT -->
<!-- ============================================================= -->
<div class="main-content">

    <!-- TOP BAR -->
    <nav class="topbar d-flex align-items-center justify-content-between shadow-sm">

        <div>
            <h5 class="mb-0 fw-semibold">Employee Management System</h5>
        </div>

        <div class="d-flex align-items-center">

            <!-- THEME TOGGLE -->
            <button id="themeToggle" class="btn btn-light border me-3 rounded-circle theme-btn">
                <i data-feather="sun"></i>
            </button>

            <!-- USER BOX -->
            <div class="user-box d-flex align-items-center px-3 py-2 rounded">

                <div class="user-avatar rounded-circle d-flex align-items-center justify-content-center me-2">
                    <i data-feather="user"></i>
                </div>

                <div>
                    <p class="mb-0 fw-semibold" th:text="${#authentication?.name ?: 'Guest'}"></p>

                    <small class="text-muted"
                           th:text="${#authorization.expression('isAuthenticated()')
                ? #authentication.principal.authorities[0].authority
                : 'Guest'}">
                    </small>

                </div>
            </div>

        </div>

    </nav>

    <!-- CONTENT WRAPPER -->
    <main class="content-wrapper p-4">
        <div layout:fragment="content"></div>
    </main>

</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Feather Icons -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        feather.replace();
    });
</script>

<!-- Theme toggle -->
<script>
    const body = document.body;
    const toggleBtn = document.getElementById('themeToggle');

    toggleBtn.addEventListener('click', () => {
        body.classList.toggle('dark-mode');
        localStorage.setItem('theme', body.classList.contains('dark-mode') ? 'dark' : 'light');
    });

    const saved = localStorage.getItem('theme');
    if (saved === 'dark') body.classList.add('dark-mode');
</script>

<!-- Safe star rating handler -->
<script>
    document.addEventListener("click", function (event) {
        if (!event.target.classList.contains("rating-star")) return;

        const star = event.target;
        const starsContainer = star.parentNode;
        const stars = starsContainer.querySelectorAll(".rating-star");

        const ratingInput = document.getElementById("ratingInput");
        if (!ratingInput) return;

        ratingInput.value = star.dataset.value;

        stars.forEach(s => s.classList.remove("selected"));
        star.classList.add("selected");
    });
</script>

<!-- â­ REQUIRED: Loads child-page JS (Fixes delete button in jobs.html) -->
<div layout:fragment="scripts"></div>

</body>
</html>
