<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">

<main layout:fragment="content" class="p-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold mb-0">Employees</h2>

        <a class="btn btn-primary px-3 py-2 rounded-3 fw-semibold d-flex align-items-center"
           th:href="@{/web/employees/add}">
            <i data-feather="user-plus" class="me-1"></i> Add Employee
        </a>
    </div>

    <!-- SEARCH BAR -->
    <div class="card shadow-sm p-3 mb-4 rounded-3">
        <input id="searchInput" type="text" class="form-control"
               placeholder="Search employeesâ€¦">
    </div>

    <!-- EMPLOYEE TABLE -->
    <div class="card shadow-sm rounded-3">
        <table class="table table-hover align-middle mb-0">

            <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Department</th>
                <th>Position</th>
                <th th:if="${#authorization.expression('hasAnyRole(''ADMIN'',''HR'')')}">Actions</th>
            </tr>
            </thead>

            <tbody id="employeeTable">

            <tr th:each="emp : ${employees}">
                <td>
                    <div class="d-flex align-items-center">
                        <div class="rounded-circle d-flex align-items-center justify-content-center"
                             style="width:40px;height:40px;background:var(--primary-light);color:var(--primary);font-weight:600;">
                            <span th:text="${emp.firstName.substring(0,1) + emp.lastName.substring(0,1)}"></span>
                        </div>

                        <div class="ms-3">
                            <strong th:text="${emp.firstName + ' ' + emp.lastName}"></strong>
                            <div class="small text-muted">ID: <span th:text="${emp.id}"></span></div>
                        </div>
                    </div>
                </td>

                <td th:text="${emp.email}"></td>
                <td th:text="${emp.department}"></td>
                <td th:text="${emp.position}"></td>

                <td th:if="${#authorization.expression('hasAnyRole(''ADMIN'',''HR'')')}">
                    <div class="d-flex gap-2">
                        <a class="btn btn-sm btn-outline-primary rounded-3"
                           th:href="@{'/web/employees/edit/' + ${emp.id}}">
                            <i data-feather="edit-3" style="width:16px;"></i>
                        </a>

                        <button class="btn btn-sm btn-outline-danger rounded-3"
                                th:onclick="'confirmDelete(' + ${emp.id} + ')'">
                            <i data-feather="trash-2" style="width:16px;"></i>
                        </button>
                    </div>
                </td>
            </tr>

            </tbody>

        </table>
    </div>

    <!-- Floating Button -->
    <a th:href="@{/web/employees/add}" class="fab-add shadow-lg">
        <i data-feather="plus"></i>
    </a>

    <!-- SweetAlert + JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        feather.replace();

        document.getElementById("searchInput").addEventListener("input", function () {
            const query = this.value.toLowerCase();
            document.querySelectorAll("#employeeTable tr").forEach(row => {
                row.style.display = row.innerText.toLowerCase().includes(query) ? "" : "none";
            });
        });

        function confirmDelete(id) {
            Swal.fire({
                title: "Delete Employee?",
                text: "This cannot be undone.",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#d33",
                confirmButtonText: "Delete"
            }).then(res => {
                if (res.isConfirmed) {
                    window.location.href = "/web/employees/delete/" + id;
                }
            });
        }
    </script>

</main>
</html>
