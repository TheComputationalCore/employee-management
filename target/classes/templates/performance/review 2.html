<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">

<head>
    <title>Manager Review</title>

    <style>
        .rating-star {
            font-size: 32px;
            cursor: pointer;
            user-select: none;
            color: #ccc;
            transition: 0.2s;
        }
        .rating-star.selected {
            color: #3498db;
            transform: scale(1.15);
        }

        .box {
            border: 1px solid var(--border);
            padding: 18px;
            border-radius: 12px;
            background: var(--card-bg);
            margin-bottom: 20px;
        }
    </style>
</head>

<body>

<main layout:fragment="content">

    <h3 class="fw-semibold mb-3">
        <i data-feather="user-check" class="me-2"></i>
        Manager Review — <span th:text="${review.cycle}"></span>
    </h3>

    <!-- Self Review Summary -->
    <div class="box">
        <h5 class="fw-semibold">Employee Self Review</h5>

        <p><strong>Self Rating:</strong>
            <span th:text="${review.selfRating}"></span>/5
        </p>

        <p class="text-muted" th:text="${review.selfComments}">No comments</p>
    </div>

    <!-- Manager Review Form -->
    <form th:action="@{'/web/performance/manager/' + ${review.id}}" method="post">

        <!-- Rating -->
        <label class="form-label">Manager Rating (1–5)</label>

        <div id="ratingStars" class="mb-3" data-feather-ignore="true">

        <span class="rating-star" data-value="1">★</span>
            <span class="rating-star" data-value="2">★</span>
            <span class="rating-star" data-value="3">★</span>
            <span class="rating-star" data-value="4">★</span>
            <span class="rating-star" data-value="5">★</span>
        </div>

        <input type="hidden" name="rating" id="ratingInput" required>

        <!-- Comments -->
        <label class="form-label mt-3">Manager Comments</label>
        <textarea name="comments" class="form-control" rows="5" required></textarea>

        <button class="btn btn-success mt-3 w-100">
            <i data-feather="check" class="me-1"></i>
            Submit Final Review
        </button>

    </form>

</main>

</body>

<script>
    document.addEventListener("DOMContentLoaded", function () {

        // star rating JS
        const stars = document.querySelectorAll(".rating-star");
        const ratingInput = document.getElementById("ratingInput");

        stars.forEach(star => {
            star.addEventListener("click", () => {

                ratingInput.value = star.dataset.value;

                stars.forEach(s => s.classList.remove("selected"));
                star.classList.add("selected");

            });
        });

        // run feather AFTER stars exist
        feather.replace();
    });
</script>



</html>
