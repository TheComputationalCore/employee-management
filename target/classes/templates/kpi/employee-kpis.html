<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<body>

<div th:insert="layout/main :: content">

    <div class="d-flex justify-content-between mb-3">
        <h2>Employee KPI Overview</h2>

        <div>
            <a class="btn btn-success"
               th:href="@{'/web/export/kpi/employee/pdf/' + ${employeeId}}">
                Download PDF
            </a>

            <a class="btn btn-info"
               th:href="@{'/web/export/kpi/employee/excel/' + ${employeeId}}">
                Download Excel
            </a>
        </div>
    </div>

    <table class="table table-striped table-bordered">
        <thead>
        <tr>
            <th>KPI Name</th>
            <th>Target</th>
            <th>Self Score</th>
            <th>Manager Score</th>
            <th>Final Weighted Score</th>
            <th>Actions</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="k : ${list}">

            <td th:text="${k.kpiName}"></td>
            <td th:text="${k.targetValue}"></td>
            <td th:text="${k.achievedSelf}"></td>
            <td th:text="${k.achievedManager}"></td>
            <td th:text="${k.finalScore}"></td>

            <td>

                <!-- Self Evaluation -->
                <button th:if="${#authorization.expression('hasAnyRole(''USER'')')}"
                        class="btn btn-sm btn-primary"
                        th:onclick="'openSelfModal(' + ${k.id} + ')'">
                    Self Score
                </button>

                <!-- Manager Evaluation -->
                <button th:if="${#authorization.expression('hasAnyRole(''ADMIN'',''HR'')}')}"
                        class="btn btn-sm btn-warning"
                        th:onclick="'openManagerModal(' + ${k.id} + ')'">
                    Manager Score
                </button>
            </td>

        </tr>
        </tbody>
    </table>

</div>


<!-- Self Score Modal -->
<div class="modal fade" id="selfModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content p-3">

            <h4 class="mb-3">Submit Self Score</h4>

            <form id="selfForm" method="post">
                <div class="mb-3">
                    <label>Your Achieved Value</label>
                    <input type="number" step="0.1" name="achieved" class="form-control" required>
                </div>

                <button class="btn btn-primary">Submit</button>
            </form>

        </div>
    </div>
</div>

<!-- Manager Score Modal -->
<div class="modal fade" id="managerModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content p-3">

            <h4 class="mb-3">Submit Manager Score</h4>

            <form id="managerForm" method="post">
                <div class="mb-3">
                    <label>Achieved Value</label>
                    <input type="number" step="0.1" name="achieved" class="form-control" required>
                </div>

                <button class="btn btn-primary">Submit</button>
            </form>

        </div>
    </div>
</div>

<script>
    function openSelfModal(id) {
        document.getElementById("selfForm").setAttribute("action", "/web/kpi/self/" + id);
        new bootstrap.Modal(document.getElementById('selfModal')).show();
    }

    function openManagerModal(id) {
        document.getElementById("managerForm").setAttribute("action", "/web/kpi/manager/" + id);
        new bootstrap.Modal(document.getElementById('managerModal')).show();
    }
</script>

</body>
</html>
