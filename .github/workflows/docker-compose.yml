version: "3.9"

services:
  employee-management:
    container_name: employee-management-app
    build:
      context: .
      dockerfile: Dockerfile
    image: employee-management:latest
    ports:
      - "8080:8080"
    environment:
      # ===============================
      # SPRING CONFIG
      # ===============================
      SPRING_PROFILES_ACTIVE: dev

      # ===============================
      # DATABASE (Neon PostgreSQL)
      # ===============================
      SPRING_DATASOURCE_URL: ${SPRING_DATASOURCE_URL}
      SPRING_DATASOURCE_USERNAME: ${SPRING_DATASOURCE_USERNAME}
      SPRING_DATASOURCE_PASSWORD: ${SPRING_DATASOURCE_PASSWORD}

      # ===============================
      # JVM TUNING (Container Safe)
      # ===============================
      JAVA_TOOL_OPTIONS: >
        -Xms128m
        -Xmx384m
        -XX:+UseG1GC
        -XX:MaxMetaspaceSize=128m

    volumes:
      # ===============================
      # FILE STORAGE (IMPORTANT)
      # ===============================
      - ./uploads:/app/uploads

    restart: unless-stopped

    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:8080/actuator/health"]
      interval: 30s
      timeout: 5s
      retries: 3

    networks:
      - employee-net

# ===============================
# NETWORK
# ===============================
networks:
  employee-net:
    driver: bridge
